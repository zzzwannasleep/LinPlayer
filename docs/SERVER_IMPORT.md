# 从“分享文本”批量导入服务器（Emby / Jellyfin）

LinPlayer 支持把常见的“线路分享文本”（多行线路 + 端口 + 密码等）解析为可导入的服务器列表，并将同一组里的多条线路保存为“可切换线路”。

## 入口

1. 进入「连接服务器」页
2. 右上角点 `+` 打开「添加服务器」
3. 选择服务器类型为 Emby / Jellyfin
4. 右上角点「批量导入」

## 使用方式

1. 粘贴分享文本到输入框
2. 点「解析」生成服务器列表；如果要继续追加下一段文本，可用「追加解析」
3. 每个服务器分组支持：
   - 勾选/取消勾选要导入的服务器
   - 勾选/取消勾选分组内的线路
   - 选择“主线路”（用于登录与保存的 baseUrl）
   - 填写账号（必填）/密码（可选，部分服务器允许空密码）
   - 可选设置备注与图标
4. 点「导入选中」

导入完成后：
- 服务器会出现在「连接服务器」页的列表中
- 该服务器的“其它线路”会作为自定义线路保存：登录进入首页后，可在右上角「线路」里切换（也可继续手动新增/编辑线路）

## 分组规则（多账号/多组线路）

- 每次出现 `用户密码:` 会开启一个新的分组；该分组会把后续识别到的线路都归在一起。
- 如果文本里能识别到 `用户密码:`，导入页会自动把它填入密码输入框（你仍需要填写账号/用户名）。
- `端口:` 会作为当前分组的“全局端口”提示：某条线路本身写了端口（如 `192.168.1.10:8096` 或 `example.com 443`）时，以该条线路端口为准。

## 支持的文本格式（尽量兼容）

解析器会尽量从每一行中提取线路与端口，常见写法都能识别：

```text
用户密码: 123456789abc
主线路（推荐）
https://www.example.com 443
CDN 线路
https://cdn.example.com 443
端口: 443
```

也支持不带 scheme（`http://` / `https://`）的写法：

```text
线路A: www.example.com 443
线路B: 192.168.1.10:8096
```

并会自动兼容部分全角标点（例如 `https：//example.com`）。

### 线路名称（显示在导入列表里）

线路名称支持两种写法：
- 行内前缀：`线路A: example.com 443`
- 上一行作为标签：
  ```text
  线路A
  example.com 443
  ```

### 不带 scheme 时的协议推断

当线路不带 `http://` / `https://` 时，解析器会按端口做一个保守推断：
- 80 / 8096 → `http`
- 443 / 8920 → `https`
- 其它端口默认 `https`（你也可以在导入页手动切换主线路的协议/端口）

## 默认勾选规则（为什么有些链接默认不勾）

为避免把“客户端地址/探针/群链接”等也当成线路导入，解析器会做一些保守判断：
- 更像“服务器根地址”的线路会默认勾选
- 常见非线路域名（例如 `t.me`、`github.com` 等）会默认不勾选

你仍可以手动勾选/取消勾选每一条线路，并指定哪一条作为“主线路”。

## 常见问题

- 提示“未解析到服务器地址”
  - 确认文本中包含 `http(s)://...` 或域名/IP（支持无 scheme）
  - 端口既可以写在 URL 后面（如 `example.com 443`），也可以写成全局端口行 `端口: 443`
- 导入成功但登录/播放不通
  - 先确认该线路在设备浏览器可访问
  - 必要时切换线路、切换 http/https、或改填端口（常见 8096/8920）
- “线路列表为空”
  - 未部署 `emby_ext_domains` 时属正常，不影响导入与播放；你仍可在「线路」里使用自定义线路

## 安全提醒

分享文本里往往包含账号/密码/Token 等敏感信息：
- 不要把分享文本原文发到公开群/Issue/截图里
- `android/release.keystore.base64.txt`、`android/key.properties` 属于签名敏感文件，务必不要入库（仓库已在 `.gitignore` 中忽略）
